
<!DOCTYPE html>
<html>
<title>T-F Quotes</title>
<head> 

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    
    <script src="https://use.fontawesome.com/c4baa82464.js"></script>        
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    
</head>
    
<style>
    
    body{
        font-family: Arial, Verdana, sans-serif;
        text-align: center;       
        background: -webkit-linear-gradient(#b1d6d2, #88a3a0, #6f8b88, #88a3a0, #b1d6d2); 
        background: linear-gradient(#b1d6d2, #88a3a0, #6f8b88, #88a3a0, #b1d6d2);
    }
    
    p {
        position: relative;
    }
    
    a, a:visited {
        color: black;
        text-decoration: none;
    }
    
    .margin-top{
        margin-top: 30px;
    }

    #flex-container{
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    #head{
        position: relative;
        border-radius: 25px;
        border: 5px outset #79766a;
        margin: 25px 0 30px 0;
        padding: 0 4%; 
        color: #696969;
        
        background: -webkit-linear-gradient(#8e9eab , #eef2f3, #8e9eab);
        background: linear-gradient(#b1b4b5 , #eef2f3, #abacad);       
    }
    
    #head > p{
        font-size: 0.8em;
    }
    
    #head .screw:nth-of-type(1){
        margin: 8px 0 0 8px;
        left:0;
    }
    
    #head .screw:nth-of-type(2){
        margin: 8px 8px 0 0;
        right: 0;   
    }
    
    #head .screw:nth-of-type(3){
        margin: -15px 0 0 8px;
        left: 0;
        top: 100%;
    }
    
    #head .screw:nth-of-type(4){
        margin: -15px 8px  0 0;
        right: 0;
        top: 100%;
    }
   
    .screw{
        position: absolute;
        width: 5px;
        height: 5px;
        border-radius: 4px;
        border: 1px solid #868585;
        background-color: #ada274;
    }
    
    .roll-bar{
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    #quote-box{
        width: 70%;
        height: 250px;
        margin-top: 15px;
        display: flex;
        flex-direction: column;
        color: #3b3b3b;
        font-family: monospace;
    }
    
    #quote{
        width: 80%;
        height: 50%;
        margin: 0 auto;
        overflow: hidden;
        padding: 10px;
        
        border-radius: 100px;
        border-top: solid 8px #626161;
        border-left: solid 5px #7b7b7b;
        border-right: solid 5px #7b7b7b;
        border-bottom: solid 8px #b5b5b5;
        
        background: -webkit-linear-gradient(#77908d, #a4c6c2, #758b88, #5e7673, #7c9391); 
        background: linear-gradient(#77908d, #a4c6c2, #758b88, #5e7673, #7c9391);
    }
    
    #author{
        width:150px;
        height: 40px;
        margin: 35px 20% 0 auto;
        overflow: hidden;
        padding: 5px;
        font-style: italic;
        
        border-radius: 100px;
        border-top: solid 4px #626161;
        border-left: solid 2px #7b7b7b;
        border-right: solid 2px #7b7b7b;
        border-bottom: solid 4px #b5b5b5;
                     
        background: -webkit-linear-gradient(#77908d, #a4c6c2, #758b88, #5e7673, #7c9391); 
        background: linear-gradient(#77908d, #a4c6c2, #758b88, #5e7673, #7c9391);
    } 
        
    #button-box-01 button{
        margin: 0 10px;
        border-radius: 4px;
        border: outset 2px lightgray;        
        color: #c1c1c1;
        
        -webkit-transition: all 0.5s ease;
        -moz-transition: all 0.5s ease;
        -o-transition: all 0.5s ease;
        transition: all 0.5s ease;
    }
    
    #button-box-01 button.lit{
        color: white;
        text-shadow: 0px 0px 5px white;
    }
     
    #twitter-btn {
        width: 40px;
        height: 30px;
        background-color: #4c8bc9; 
    }
    
    #twitter-btn.lit{
        background-color: #5baaf7;
    }
        
    #nq-btn{
        height: 30px;
        background-color: #1f7c5a;
    }
    
    #nq-btn.lit{
        background-color: #7abea1;
    }
        
    #button-box-02{
        width: 55%;
        height: 75px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    #result-display{
        width: 75%;
        height: 70px;
        margin: 0 15px;
        border-radius: 50px;
        overflow: hidden;
        border-top: solid 5px #626161;
        border-left: solid 3px #7b7b7b;
        border-right: solid 3px #7b7b7b;
        border-bottom: solid 5px #b5b5b5;
        font-family: monospace;
        padding: 2%;
        color: #3b3b3b;
        
        background: -webkit-linear-gradient(#829b99, #a3c6c2, #85a09c, #6e8d89, #88a2a0); 
        background: linear-gradient(#829b99, #a3c6c2, #85a09c, #6e8d89, #88a2a0);
    }
    
    .guess-btn{
        width: 75px;
        height: 70px;
        border-radius: 5px;
        border: outset 4px #b5b5b5;
        color: #c1c1c1;
        
        -webkit-transition: all 0.5s ease;
        -moz-transition: all 0.5s ease;
        -o-transition: all 0.5s ease;
        transition: all 0.5s ease;
    }
    
    .guess-btn.lit{
        border-color: #d8d8d8;
        color: white;
        text-shadow: 0px 0px 8px white;
    }
        
        
    #true-btn{
        background-color: #1f7c5a;
    }    
    
     #true-btn.lit{
        background: #24ad49;
    }
    
    #false-btn{
        background-color: #b14c33;
    }
    
    #false-btn.lit{
        background: #e8492c;
    }
    
    @media only screen and (max-width:768px)
    {
        #author{margin: 25px auto 0 auto;}
        #quote-box{margin: 0;}
        #head{font-size: 0.9em;}
    }
    
    @media only screen and (max-width:1000px)
    {
        #quote-box{width:95%;}
        #button-box-02{width:95%;}
    }

</style>    
    
<body>
       
    <div id="flex-container">
        
         <div id="head">
            <div class="screw"></div>
            <div class="screw"></div>
            <h3>Truthy/Falsey Quote Machine</h3>
            <p>Request a new quote and try to guess if it matches with the author,<br />
                if you guess right you'll be able to tweet the quote!</p>
            <div class="screw"></div>
            <div class="screw"></div>
        </div>
        
        <div id="quote-box">
            <div id="quote" class="roll-bar"><p>Thanks to <a href="https://gist.github.com/dmakk767"> Dustin McDaniel</a>, who was so kind to provide the api used for this quote machine!</p></div>
            <div id="author" class="roll-bar"><p><em>- me</em></p></div>
        </div>
        
        <div id="button-box-01" class="margin-top">
            <button id="nq-btn" class="lit" type="button">request new quote</button>
            <a target="_blank"><button id="twitter-btn" class="fa fa-twitter" type="button"></button></a>
        </div>
        
        <div id="button-box-02" class="margin-top">
            <button id="true-btn" class="guess-btn" type="button" value="true">TRUE</button>
            <div id="result-display" class="roll-bar"><p>Request a new quote</p></div>
            <button id="false-btn" class="guess-btn" type="button" value="false">FALSE</button>
        </div>
    
    </div>
    
    <script>
        
        var quotesPool = [];
        var gamestate = "begin";
        var currentQt = null;
        var realQuotesApi = "https://gist.githubusercontent.com/dmakk767/9375ff01aff76f1788aead1df9a66338/raw/491f8c2e91b7d3b8f1c8230e32d9c9bc1a1adfa6/Quotes.json%2520";
        var phoneyQuote = {
            quote:"KHBkdlòsadl,-s,dàdeò,s fòamòlmf3òref9cw4240jq4294fàdf,  eqkmw3omldf3daò,fdòlfdsòflmdaskm",
            author:"- My cat, walking on the keyboard",
            realAuthor: "me"
        };
        var chachedQR = $("#result-display").children("p").html();
        var totalGames = 0;
        var finalRollsCounter = 0;
        var maxRolls = 0;
        
        console.log("consider right guess AND author-quote match possibilty!!!!");
                                      
        $("#nq-btn").click(function(){            
            if($(this).hasClass("lit"))
            {
                totalGames++;
                gamestate = "guessing";
                fetchQuotes(realQuotesApi, 4); 
                $("#nq-btn, #twitter-btn").removeClass("lit");
                $("#twitter-btn").parent().removeAttr("href");
            }
        });
        
        $(".guess-btn").click(function(){            
            if($(this).hasClass("lit"))
            {
                var answer = $(this).val() === "true" ? true : false;
                guessResult(answer);
                $(".guess-btn").removeClass("lit");
            }
        });
        
        $("#twitter-btn").click(function(){
            if($(this).hasClass("lit"))
            {
                $(this).parent().attr("href", "https://twitter.com/intent/tweet?text=" + "'" + currentQt.quote + "'" + "  " + currentQt.realAuthor);
            }
        });
     
        function fetchQuotes(api, number)
        {                        
            $.getJSON(api, function(data){
                
            var indexes = [];
            var newIdx;    
            
            for(var i=0; i < number; i++)
            {
                newIdx = Math.floor(Math.random() * data.length);
                
                while(indexes.includes(newIdx))
                    newIdx = Math.floor(Math.random() * data.length);
                
                indexes.push(newIdx);             
                quotesPool.push(data[newIdx]);               
            }
                
                generateQuote();
            });
        }
        
        function generateQuote()
        {
            var randEvaluation = Math.random();

            if(randEvaluation < 0.1 && totalGames >= 5)
            {               
               currentQt = phoneyQuote;
            }
            else if(randEvaluation >= 0.1 && randEvaluation <= 0.5)
            {
                currentQt = {
                    quote:quotesPool[0].quote, 
                    author:"- " + quotesPool[0].name, 
                    realAuthor:"- " + quotesPool[0].name
                };
            }
            else
            {
                currentQt = {
                    quote:quotesPool[0].quote, 
                    author:"- " + quotesPool[quotesPool.length - 1].name, 
                    realAuthor:"- " + quotesPool[0].name
                };    
            }
                       
            quotesPool.shift();            
            rollBars();                        
        }
        
        function rollBars()
        {
            maxRolls += 3;
            var quotes = quotesPool.map(function(item){return item.quote;})
            var authors = quotesPool.map(function(item){return item.name;});
            
            multiRoll($("#quote"), quotes.length, quotes, currentQt.quote);
            multiRoll($("#author"), authors.length * 2, authors, currentQt.author);          
            setTimeout(function(){
                closingRoll($("#result-display"), "Is that the real author of the quote?");
            }, 2500);
        }
     
        function closingRoll(div, html)
        {
            div.children("p").animate({top:"100%"},250, function(){
                $(this).html(html);
                $(this).css("top", "-100%");
            }).animate({top:"0"}, 250).animate({top:"-4px"}, 50).animate({top:"4px"}, 50).animate({top:"-2px"}, 50).animate({top:"0px"}, 50, function(){
                
                finalRollsCounter++;
                if(finalRollsCounter >= maxRolls)
                {
                    finalRollsCounter = 0;
                    maxRolls = 0;
                    nextAction();                     
                }
            });             
        }
        
        var rollCount = 0;
        function multiRoll(div, rolls, arr, html)
        {    
            var idx = rollCount >= arr.length ? rollCount - arr.length : rollCount;
            var randomTxt = arr[idx];
            
            div.children("p").animate({top:"100%"}, 250, function(){
                $(this).html(randomTxt);
                $(this).css("top","-100%");
            });
            
            if(rollCount < rolls)
            {
                rollCount++;
                multiRoll(div, rolls, arr, html);                
            }
            else
            {
                rollCount = 0;
                closingRoll(div, html);
            }
        }
        
        function guessResult(answer)
        {
            var guessed = (currentQt.author === currentQt.realAuthor) === answer;
            var result = guessed ? "Right! " : "Wrong! ";
            var output = result + "It is actually a quote by " + currentQt.realAuthor.replace("-", "");
            
            if(currentQt.realAuthor === "me")
                output = "Ok, ok... this one was a joke.";
            
            gamestate = guessed ? "guessed-right" : "guessed-wrong";
                      
            maxRolls++;
            closingRoll($("#result-display"), output);
            
            if(guessed && currentQt.realAuthor !== currentQt.author)
            {
                maxRolls++;
                closingRoll($("#author"), currentQt.realAuthor);
            }
        }
        
        function nextAction()
        {
            if(gamestate == "guessed-wrong")                
                $("#nq-btn").addClass("lit");        
            else if(gamestate == "guessed-right")
                $("#nq-btn, #twitter-btn").addClass("lit");
            else if(gamestate == "guessing")
            {
                quotesPool.length = 0;
                $(".guess-btn").addClass("lit");
            }            
        }
                
    </script>
        
</body>    
</html>